# 实验2 使用OEM管理表空间与用户

## 1. Oracle Enterprice Manager 简介

Oracle企业管理器，英文名Oracle Enterprise Manager，是Oracle公司提供的以web界面的形式管理Oracle数据库的工具。到了Oracle 12c时代，EM不需要单独安装配置了，创建数据库的时候勾选EM express即可。因为很多功能都转移到了SQL developer里，所以12c的EM叫EM express。

## 2. 登陆Oracle EM 控制台

在上一个实验中我们已经配置好了Oracle EM控制台，可以在浏览器中输入OEM的网址`http://虚拟机的 ip 地址:8080/em`，如果OEM配置正确，则在浏览器中会显示如下的登陆界面。【注】尽量使用Chrome浏览器进行本实验，并且浏览器需要安装Flash插件。

![](pic/1.png)

输入用户名与口令，点击登录即可进入到控制台主界面。这里使用system用户登录。

![](pic/2.png)

## 3. 创建表空间

点击页面顶端的标签栏，选择“存储”标签下的“表空间”选项，进入到表空间管理界面。

![](pic/3.png)

点击“创建”按钮，开始创建一个新的表空间。表空间名称是必填字段，其余都按照默认值，点击右下角的蓝色按钮进入到下一步。【注意】表空间名不区分大小写。

![](pic/4.png)

进入下一步需要设置表空间中的数据文件，每个表空间中可以存在多个数据文件，因此在这里我们新建一个数据文件test1.dbf。默认数据文件的大小为100M，当该文件中的数据量超过该大小时如需自动拓展大小，则要把自动拓展的按钮勾选上，默认的增量为100M。

![](pic/5.png)
![](pic/6.png)
![](pic/7.png)
![](pic/8.png)

点击蓝色的按钮依然可以进入下一页设置块大小、日志记录以及段空间管理，这里没有特殊需求按照默认即可。
在上述窗口中左下角有一个“显示SQL“按钮，点击此按钮可以将刚才的所有设置转为SQL语句。点击查看新建表空间SQL语句，有关SQL语句的知识在此处不过多介绍。

![](pic/9.png)

点击确定即可按照刚才的设置建立表空间，稍等一会等待表空间建立成功。

![](pic/10.png)

在选中表空间的情况下可以再往里面填加数据文件。

![](pic/11.png)

## 4. 删除表空间
选中表空间点击“删除”按钮可以将表空间删除。

![](pic/12.png)

点击显示SQL按钮同样也可以显示“删除表空间的SQL代码。

![](pic/13.png)

点击确定稍等片刻所选中的表空间就会被删除。

## 5. 用户的解锁与锁定
点击“安全”标签页下的用户“选项”可以对数据库的用户进行管理。

![](pic/14.png)

用户界面如下，在Oracle数据库创建之初就已经有了许多默认的用户，但是大部分都处于锁定状态。下表中第一列是用户名，第二列是账户的状态。用户状态中绿色的对勾表示该用户已经被打开，能够正常进行登录。另外在第二列中有一些用户的状态是一个时钟加一把锁，时钟表示该用户的口令已过期，锁表示该用户被锁定。

![](pic/15.png)


Oracle数据库在刚开始创业时雇佣的第一位员工叫Scott，因此为了纪念他，之后在每一代的Oracle数据库中都有一个Scott用户。Oracle 12c也不例外，但是该用户默认是锁定的，因此我们需要将其解锁。
找到scott用户，点击空白处使得这行处于高亮状态（注意不要点击用户名进入到下一个页面），点击“操作”按钮，选择“变更计数选项。

![](pic/16.png)

进入变更计数窗口，可以看到这里有设置口令的对话框与账户锁定的勾选框，在这里设置登录口令并取消账户已锁定的勾选框即可对scott用户解锁。这里登录口令设置为tiger。点击确定完成解锁。

![](pic/17.png)

解锁成功后可以看到scott用户的账户状态变成了绿色的对勾。

![](pic/18.png)

此时可以尝试使用SQLDeveloper、SQLPlus或者Navicat来登录scott用户（这里用Navicat）。

![](pic/19.png)

如果需要锁定用户，同样是选择用户，进入“变更计数”窗口，勾选“口令已失效”与“账户已锁定”的勾选框，点击确定即可锁定用户。Scott的用户状态又变成了一个钟和一把锁的图案，同时尝试登录scott用户时也会报错。

![](pic/20.png)

## 6. 创建新用户
有时候使用Oracle自带的用户往往不能满足需求，因此在OEM中也可以自行创建用户。点击页面上部的”创建用户“的按钮。在弹出窗口中输入用户名以及登录口令，点击下一页按钮设置默认的表空间。

![](pic/21.png)

在这里点击下拉菜单即可设置默认表空间，这里使用默认的USERS。点击下一页。

![](pic/22.png)

接下来要为用户设置权限，这里有很多权限可以选择，通常要考虑实际情况给用户赋予合适的权限。在权限的名称右侧有一列“是角色”，如果这一项被勾选则表示该权限为角色。“角色”是权限的合集，假设要为某用户设置多条权限，我们可以定义一个角色将这些权限全包括进去，最后只需要为这名用户赋予这个角色即可。

![](pic/23.png)

Oracle数据库中有三个比较常用的标准角色：CONNECT、RESOURCE与DBA。Connect角色是临时用户，没有建表的权限；Resource角色则拥有创建表的权限；DBA角色是数据库管理员，拥有所有系统权限。具体可以参考Oracle文档。
在这里为这位用户赋予CONNECT的角色，在左侧的权限列表中找到Connect，将其添加到右侧待选框中。

![](pic/24.png)

点击确定完成用户的创建。

![](pic/25.png)

新建的用户如下，同样可以使用SQLDeveloper、SQLPlus或者Navicat登录该用户。

![](pic/26.png)

测试连接。

![](pic/27.png)

## 7. 修改用户权限
点击用户名可以进入该用户的详细信息页面。

![](pic/28.png)

现在要将该用户的权限改为DBA，把CONNECT角色移除并添加DBA的角色。
![](pic/29.png)


点击确认即可将该用户的角色变为数据库管理员。

## 8. 更改口令与删除用户
如需要更改用户的登录口令，首先先选中该用户，进入“变更计数”对话框，重新设置用户的口令即可。

![](pic/30.png)

如需删除用户则需要先选中该用户，选择删除用户，点击确定即可。

![](pic/31.png)

## 9. 课后作业
(1)	重复有关创建表空间的步骤，每位同学创建一个与自己姓名汉语拼音相同的表空间。

(2)	创建一个与自己姓名汉语拼音相同的用户，密码为你的学号。此用户的角色为Resource，并将该用户的默认表空间设置为上一步创建的表空间。

(3)	尝试使用上一步创建的用户登录Oracle Enterprice Manager，看看能否成功进入OEM的控制台。如果不能，根据登录界面给的提示为该用户添加相应的权限，再尝试一遍能否成功登录。





